{% extends 'base.html' %}
{% load i18n %}

{% block content %}

{% block extra-js %}
<script src="{{ STATIC_URL }}js/form.js"></script>
{% endblock %}

<div class="row">
  <div class="span12">
    <h1>{{ etablissement.etablissement.nom }}</h1>
  </div>
</div>

<form id="participate-form" method="POST" action="{% url form_url etablissement.id %}">
  {% csrf_token %}
  <div id="participant-form" class="row">
    <p class="span10">
      {% trans 'Mon établissement souhaite apparaître sur le portail CSF en francophonie' %}
    </p>
    <div class="span1">
      <div class="ouinon">
	<label>Oui</label><input onchange="participate()" {% if etablissement.participant %}checked {% endif %}type="radio" name="change-participate" value="true" />
      </div>
    </div>
    <div class="span1">
      <div class="ouinon">
	<label>Non</label><input onchange="participate()" {% if not etablissement.participant %}checked {% endif %}type="radio" name="change-participate" value="false" />
      </div>
    </div>
  </div>
</form>

<div id="wrapper" class="row">
  <div id="offre-formulaire" class="span8">
    <form id="draft-form" method="POST" action="{% url form_url etablissement.id %}">
      {% csrf_token %}

      <div class="row">
	<div class="span8">
	  <h2>{% trans 'Brouillon' %}</h2>
	</div>
      </div>

      <!-- Formulaires URL -->

      <h3>URLs</h3>
      {{ due.management_form }}
      {% for form in due %}
      {{ form.type }}
      {{ form.etablissement }}
      {{ form.id }}
      <div class="row">
	<div class="span4">
	  <label>{{ form.instance.type.display_name }}</label>
	</div>
	<div class="span4">
	  {% if form.url.errors %}
	  {% for error in form.url.errors %}
	  <div class="formError text-error">{{ error }}</div>
	  {% endfor %}
	  {% endif %}
	  <input class="input-xlarge" type="text" placeholder="{{ form.instance.type.display_name }}" maxlength="{{form.url.max_length}}" id="id-{{ form.prefix }}-url" name="{{ form.prefix }}-url"{% if form.url.value %} value="{{ form.url.value }}"{%endif %} />
	</div>
      </div>
      {% endfor %}
      <hr />

      <!-- Formulaires Disciplines -->

      <h3>Offres de formations</h3>
      <div class="offres-wrapper">
	<div class="row">
	  <div class="span4">
	    <label>Discipline</label>
	  </div>
	  {% for niveau in niveaux %}
	  <div class="span1">
	    <label>{{ niveau.display_name }}</label>
	  </div>
	  {% endfor %}
	</div>

	{{ dof.management_form }}
	<div>
	  {% for form in dof %}
	  {% with forloop.counter0|divisibleby:dof_column_count as start_row%}
	  {% with forloop.counter|divisibleby:dof_column_count as end_row %}
	  {% if start_row %}
	  <div class="row offre-formation-row">
	    <div class="span4">
	      <label>{{ form.instance.discipline.display_name }}</label>
	    </div>
	    {% endif %}
	    {{ form.discipline }}
	    {{ form.etablissement }}
	    {{ form.niveau }}
	    {{ form.id }}
	    <div class="span1">
	      {{ form.offert }}
	    </div>
	    {% if end_row %}
	  </div>
	  {% endif %}
	  {% endwith %}
	  {% endwith %}
	  {% endfor %}
	</div>
      </div>
    </form>
  </div>
  <div id="publication" class="span4">
    <div class="row">
      <div class="span4">
	<h2>{% trans 'Information publiée' %}</h2>
      </div>
    </div>

    {% if etablissement.participant %}

    <h3>URLs</h3>
    {% for form in p_due %}
    <div class="row">
      <div class="span4">
	{% if form.url.errors %}
	{% for error in form.url.errors %}
	<small class="text-error">{{ error }}</small>
	{% endfor %}
	{% endif %}
	<input readonly class="input-xlarge" type="text" placeholder="{{ form.instance.type.display_name }}" maxlength="{{form.url.max_length}}" id="id-{{ form.prefix }}-url" name="{{ form.prefix }}-url" {% if form.url.value %} value="{{ form.url.value }}"{%endif %} />
      </div>
    </div>
    {% endfor %}
    <hr />

    <!-- Formulaires Disciplines -->
    
    <div class="offres-wrapper">
      <h3>Offres de formations</h3>
      <div class="row">
	{% for niveau in niveaux %}
	<div class="span1">
	  <label>{{ niveau.display_name }}</label>
	</div>
	{% endfor %}
      </div>

      <div>
	{% for form in p_dof %}
	{% with forloop.counter0|divisibleby:dof_column_count as start_row%}
	{% with forloop.counter|divisibleby:dof_column_count as end_row %}
	{% if start_row %}
	<div class="row offre-formation-row">
	  {% endif %}
	  {{ form.discipline }}
	  {{ form.etablissement }}
	  {{ form.niveau }}
	  {{ form.id }}
	  <div class="span1">
	    {{ form.offert }}
	  </div>
	  {% if end_row %}
	</div>
	{% endif %}
	{% endwith %}
	{% endwith %}
	{% endfor %}
      </div>
    </div>

    {% else %}

    <p class="text-error">{% trans 'Aucune information n&#39;est publiée.' %}</p>

    {% endif %}

  </div>
  <div id="actions" class="span12">
    <div class="row">
      <div class="span3">
	<input onclick="$('#draft-form').submit();" class="btn btn-primary" type="button" value="{% trans 'Enregistrer le brouillon' %}" />
      </div>
      <div class="span3">
	<form method="POST" action="{% url form_url etablissement.id %}">
	  {% csrf_token %}
	  <input type="hidden" name="publish" value="doit" />
	  <input class="btn btn-success" type="submit" value="{% trans 'Publier le brouillon' %}" />
	</form>
      </div>
      {% if etablissement.participant %}
      <div class="span3">
	<form method="POST" action="{% url form_url etablissement.id %}">
	  {% csrf_token %}
	  <input type="hidden" name="take-down" value="doit" />
	  <input class="btn btn-danger" type="submit" value="{% trans 'Enlever la publication' %}" />
	</form>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

